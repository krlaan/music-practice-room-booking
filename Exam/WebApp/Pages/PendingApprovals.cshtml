@page
@model WebApp.Pages.PendingApprovalsModel

@{
    ViewData["Title"] = "Pending Approvals";
}

<div class="card shadow-sm mb-4">
    <div class="card-body">
        <h1 class="text-center mb-4 text-primary fw-bold">Pending Booking Approvals</h1>

        @if (Model.PendingBookings.Count == 0)
        {
            <div class="alert alert-info text-center">
                <h5>No pending approvals</h5>
                <p>All recital prep bookings have been approved or rejected.</p>
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped table-hover rounded shadow-sm text-center">
                    <thead>
                    <tr>
                        <th class="text-center">Student</th>
                        <th class="text-center">Room</th>
                        <th class="text-center">Start Time</th>
                        <th class="text-center">End Time</th>
                        <th class="text-center">Duration</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var booking in Model.PendingBookings)
                    {
                        <tr>
                            <td class="text-center">
                                <strong>@booking.Student.FullName</strong>
                                <br/>
                                <small class="text-muted">@booking.Student.ProgramType</small>
                            </td>
                            <td class="text-center">
                                @{
                                    var room = booking.Room;
                                    var features = new List<string> { room.RoomNumber, room.Size.ToString() };
                                    if (room.HasGrandPiano) features.Add("Grand Piano");
                                    if (room.HasUprightPiano) features.Add("Upright Piano");
                                    if (room.IsSoundproofed) features.Add("Soundproofed");
                                    <span>@string.Join(" | ", features)</span>
                                }
                            </td>
                            <td class="text-center">@booking.StartTime.ToString("yyyy-MM-dd HH:00")</td>
                            <td class="text-center">@booking.EndTime.ToString("yyyy-MM-dd HH:00")</td>
                            <td class="text-center"><strong>@booking.DurationHours hours</strong></td>
                            <td class="text-center">
                                <form method="post" class="d-inline">
                                    <button type="submit" asp-page-handler="Approve" asp-route-bookingId="@booking.Id"
                                            class="btn btn-sm btn-success">
                                        ✓ Approve
                                    </button>
                                </form>
                                <form method="post" class="d-inline">
                                    <button type="submit" asp-page-handler="Reject" asp-route-bookingId="@booking.Id"
                                            class="btn btn-sm btn-danger">
                                        ✗ Reject
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        }

        <div class="text-center mt-4">
            <a asp-page="/Bookings/Index" class="btn btn-secondary">Back to All Bookings</a>
        </div>
    </div>
</div>
